title: 数组去重与铺平
type:
  - tags
  - categories
date: 2016-03-20 22:56:02
tags: [数组,js]
categories: [前端,js]
---
这一次说一下关于数组的去重和铺平，因为这是实际业务开发中经常遇到的。
## 数组的判断
先做个铺垫，不直接说起如何进行数组的去重和铺平，而是先说一下怎么判断数组，因为要进行数组的处理当然要先判断下传过来的数据是不是数组。

首先我们都知道js的数据类型只有5种，分别是Undefined、Null、Boolean、Number和String，数组只是一个对象，用`typeof([])`返回的结果知识一个Object的字符串，因此我们需要通过其他手段来判断它，这里就说两种方法。
### 第一种用instenceof方法
instanceof是ES5提供的一个方法，它可以用来判断实例是否是某个类的实例，例如:
```javascript
[] instenceof Array
//返回结果是true
```
这种方法的不好之处就是兼容性不好，对于一些低版本浏览器不支持ES5的就要懵逼了。
### 第二种方法是通过原型链的方式来判断
了解js的话都应该懂得js这个语言的特点就是原型链式的，所有的对象都继承自Object.prototype,而prototype上又有toString()方法，这个toString()方法是干什么用的呢？就是以字符串的形式返回当前对象的值。第一次看可能这句话可能不大明白，举个例吧：
```javascript
var num = 123;
num.toString(); //返回结果为"123"
```
有没有看明白一点？就是返回num这个对象值的字符串形式，也就是"123"。好了，这跟判断数组有什么关系？想一下所有的对象都继承自Object.prototype，数组也是啊，如果把一个数组送到Object.prototype里作为一个“值”，在调用toString()方法，那它应该显示出这个对象的名字才对啊，这就是判断的原理，代码如下：
```javascript

Object.prototype.toString.call([]); //结果是"[object Array]"

```
像jQuery这样的脚本库的isArray()用的就是这个方法。

## 数组铺平
说完判直奔主题，先是数组铺平，什么是数组铺平呢？就是把`[1,[2,[3,4],5]]`铺成`[1,2,3,4,5]`。关于数组铺平我有两种思路，第二种比较奇葩，留点悬念吧哈哈。

### 第一种是常规思路
对数组进行遍历，如果数组里面套着数组就继续遍历里面的，直到把每个元素都遍历完，然后一边遍历一边塞入新的数组变量里，这样就完成铺平了，具体代码如下：
```javascript
panelArr = function(arr){
    var newArr = [];
    var isArray = function(obj) {
        return Object.prototype.toString.call(obj) === '[object Array]';
    };
    var dealArr = function(arr){
        for (var i = 0;i<arr.length;i++){
            isArray(arr[i]) ? dealArr(arr[i]) : newArr.push(arr[i]);
        }
    };
    dealArr(arr);
    return newArr;
};
console.log(panelArr([1,[2,3]])); //[1,2,3]
```
当然这个方法也可以写在`Array.prototype`里，使用起来更方便。这个方法有个问题就是内存占用上，因为采用递归如果数据量大了会占用大量大量内存。
### 第二种奇葩思路
第二种思路就是不把数组来看，也不遍历了直接铺平。听起来略奇怪，怎么能不遍历就铺平？就是使用`join()`方法，将数组转换成字符串，然后正则去掉符号最后合并，这个方法在使用注意不能`join("")`,因为如果这样分割的话，13是1和3还是13？不好区分，代码如下：
```javascript
var arr = [1,2,[33,43],20,19];
arr.join(".").replace(/,/g,".").split("."); //["1", "2", "33", "43", "20", "19"]
```
注意这个方法会转换数据类型成字符串。
## 数组去重
下面是数组去重，举例来说就是`[1,2,3,3,4,5,5,5,6]`变成`[1,2,3,4,5,6]`。这个实现的核心就是去重这里，如果能够快速判断元素是否重复就是关键。

还是两种思路
### 第一种遍历的思路
就是准备一个新的数组变量，塞入前每次对这个变量进行遍历看看是否有重复的，如果没有就塞入，最后生成的新数组就是去重后的数组了。示例代码如下:
```javascript
	function uniqueArr(arr){
		var newArr = [];
		newArr.push(arr[0]);
		for(var i = 1; i<arr.length;i++){
			var repeat = false;
			for(var j = 0;j<newArr.length;j++){
				if(arr[i] == newArr[j]){
					repeat = true;
				}
			}
			if(!repeat){
			newArr.push(arr[i]);
			}
		}
		return newArr;
	}
```
### 第二种使用哈希判断
上面那个时间复杂度为O(n^2)的方法并不是什么好方法，它的瓶颈就是判断是否重复这里，所以我们换成一个更高效的检索是否重复的方法，这个方法就是哈希，为什么哈希检索最快？翻翻数据结构吧，这里就不在赘述了。

这个方法的思路就是在原始数组和去重数组之间加入一个哈希过滤，总的来看就是原数组数据交给哈希，看是否有重复，若是没有则添加进去。具体代码如下：
```javascript
	function uniqueArr(arr){
		var newArr = [],
			hashFilter = {};
		for(var i = 0;i<arr.length;i++){
			if(!hashFilter[arr[i]]){
				//若不存在将此属性对应的值改为true,并塞入去重数组中
				hashFilter[arr[i]] = true;
				newArr.push(arr[i]);
			}
		}
		return newArr;
	}
```
我青睐第二种，因为在判断是否重复这里真的很快，可以说是秒出。